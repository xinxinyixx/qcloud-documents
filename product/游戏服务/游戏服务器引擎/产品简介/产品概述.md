游戏服务器引擎（Game Server Engine，缩写 GSE）提供专用游戏的服务器托管服务，支持有状态的游戏服务部署和扩缩容，实现服务发现、高效灵活的服务器伸缩和就近调度的能力，帮助开发者快速构建稳定、低延时的多人游戏的部署环境，并节约大量的运维成本。支持 C# 和 C++ 游戏引擎和自定义框架的部署和运行，应用于 FPS、MOBA、回合制、MMORPG、棋牌游戏中战斗服、消息 PUSH 等需要保持状态的场景。



## 产品架构 
游戏服务器引擎为游戏代码包提供运行环境，该环境可以进行服务发现、扩缩容、多地部署、就近调度，开发者在服务端框架中集成 GSE 的 ServerSDK，客户端通过 API 请求游戏服务器，GSE 返回最恰当的游戏服务器供客户端访问。

![整体架构](https://main.qcloudimg.com/raw/59a4b13235b564f68af2076c1fd09def.svg)


## 产品功能 

### 程序部署和更新 

- **程序部署**：开发者可以通过 GSE 上传程序代码包和依赖，GSE 将程序部署到服务器舰队（fleet），并根据配置启动。
- **不停服更新**：游戏场景一般会停服更新，但 GSE 提供别名机制，可以实现不停服更新。
- **A/B Test**：可轻松实现 A/B Test，或者结束 A/B Test。



### 服务器实例管理 

#### 弹性伸缩 
- 以一天为周期进行弹性伸缩：GSE 可设置服务器实例类型和伸缩范围，实例将在这个范围内进行伸缩。游戏的访问每天都有高峰和低谷，通常在中午和晚上时，服务器实例的数量将有一个高峰，在午夜后，服务器实例的数量会降到最低。GSE 将根据每天每个时刻服务器的访问量进行自动伸缩。 
- 有状态的缩容：GSE 不会缩减有进程运行的实例，低负载触发缩容时通知游戏进程正在缩容该台服务器，并屏蔽新的游戏服务器会话分配到该台服务器上，但不强制缩减实例致客户端无法连接，等待游戏进程发起结束指令后，才真正触发停止进程和回收服务器。


#### 多地部署
GSE 支持多地部署，在多个地区构建服务器舰队，构建成一个服务器舰队的队列，当请求队列时，系统自动选择运行正常地域的服务器舰队，供游戏客户端访问，开发者也可手动调整舰队优先级。某个地域出现故障后，短时间内切换到其他地域。

#### 全球发布 
GSE 在上海、北美等地部署，即将部署在更多区域。


### 游戏服务器会话管理 
GSE 对游戏服务器会话进行管理和分配，GSE 会根据配置预先启动游戏服务器会话，通常一个进程代表一个游戏服务器会话，但也不排除部分游戏服务器会话有多个进程（但只有一个进程会与 GSE 通信）。根据请求为客户端分配一个游戏服务器会话，当不需要时程序可以关闭游戏服务器会话。

#### 游戏服务器分配 
游戏服务器会话运行在服务器实例上，GSE 会根据配置自动启动游戏服务器会话，游戏服务器会话上报其状态，GSE 会对游戏服务器会话做健康检查，根据健康情况、就绪状态、网络延时、机器的负载等情况为玩家分配正常的空闲游戏服务器会话。

就近分配：GSE 可以根据网络延时选择离玩家最近的地域分配给玩家。


#### 游戏服务器销毁 
当游戏服务器会话上没有玩家，或者游戏服务器会话不健康时，游戏服务器会话会主动或者被动地进行关闭和销毁，但在销毁前会保存日志，方便开发者查找问题。


#### 游戏服务器会话伸缩 
服务器实例（CVM）分配给舰队时，会根据配置自动启动游戏服务器会话，一个服务器实例（CVM）上可运行一个或多个游戏服务器会话（Game Server Session），如果负载降低到一定程度，CVM 达到缩容时，GSE 会通知游戏服务器会话，游戏服务器会话决定是否缩容。


### 监控和日志 
系统提供服务器实例（CVM）监控、游戏服务器会话监控和操作日志。
